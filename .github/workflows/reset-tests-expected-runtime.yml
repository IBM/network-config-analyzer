name: reset-tests-expected-runtime

on:
  workflow_dispatch: # manual triggering

permissions:
  actions: read
  contents: read

jobs:
  reset_all_tests_runtime:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@dcd71f646680f2efd8db4afa5ad64fdcba30e748
      - uses: ./.github/actions/setup-nca-env
      - uses: dawidd6/action-download-artifact@b2abf1705491048a2d7074f7d90513044fd25d39
        with:
          workflow: test-push.yml
          workflow_conclusion: success
          name: run-alltests-log
          path: tests/
      - name: run script to update expected run time for all tests
        run: |
          python tests/update_expected_runtime.py --changed_tests ALL_TESTS
          rm tests/run_log.txt
      - name: Commit changes
        run: |
          git config user.name ${{ github.actor }}
          git config user.email '${{ github.actor }}@users.noreply.github.com'
          git add tests/tests_expected_runtime.csv
          git diff-index --quiet HEAD || ( git commit -m"Updating expected-runtimes file" && git push )
